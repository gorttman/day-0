# FILE: roles/prep-rootfs/tasks/install_debootstrap.yml
---
# Install the debootstrap utility on the build host (k8smaster).

- name: Ensure apt cache is up to date
  ansible.builtin.apt:
    update_cache: true
  become: true

- name: Install required packages for rootfs build
  ansible.builtin.apt:
    name:
      - debootstrap
      - qemu-user-static
      - binfmt-support
      - ca-certificates
      - curl
    state: present
  become: true

- name: Verify debootstrap is available
  ansible.builtin.command:
    cmd: which debootstrap
  register: _debootstrap_check
  changed_when: false
  failed_when: _debootstrap_check.rc != 0
