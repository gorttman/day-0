---
- name: Create ArgoCD Git credentials secret
  kubernetes.core.k8s:
    kubeconfig: "{{ kubeconfig }}"
    state: present
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: "{{item.name }}"
        namespace: argocd
        labels:
          argocd.argoproj.io/secret-type: repository
      stringData:
        name: "{{item.name }}"
        type: git
        url: "{{ item.repo }}"
        username: "{{ git_user }}"
        password: "{{ git_token }}"
  loop: "{{ bootstrap_repos + config_repos }}" 
